$(function () {
  var dataArr = [
    {
      id: 5718,
      isDelete: 0,
      name: "韦博英语东莞运营类",
      advType: "195,201",
      advTitle: "韦博英语",
      advIntro: "恭喜获得价值399英语课程",
      imageUrl:
        "https://hdggcdn.bayimob.com/base_img_path_hdggadv/5993/1554894153765_ll6xkw5jrp (1).gif",
      urlPath:
        "http://cms.webi.com.cn/dqmkt/south/dongguan/qinran/?ADID=DGJTQNJB85&cityname=DG",
      customerId: 5993,
      doumobkey: "krcvA8NZVV5t2TDfiHtoig==",
      issuedTime: 1555933863636,
      sessId: "SqGRHqAfcFzF",
      repeatIssued: 0,
      adTags: "",
      advMaterialId: 55756,
      promotionTarget: 1,
      receiveText: "免费领取",
      manualBidPrice: 0.3,
      dkey: "5cbdaaa7f10c57127a8f1058",
      sort: 0,
      advLayout: 1,
      expected: 0.0669,
      entityAdvForm: 1,
      onclick: function() {
        styleReset();
      }
    },
    {
      id: 5718,
      isDelete: 0,
      name: "韦博英语东莞运营类",
      advType: "195,201",
      advTitle: "韦博英语",
      advIntro: "恭喜获得价值399英语课程",
      imageUrl:
        "https://hdggcdn.bayimob.com/base_img_path_hdggadv/5993/1554894153765_ll6xkw5jrp (1).gif",
      urlPath:
        "http://cms.webi.com.cn/dqmkt/south/dongguan/qinran/?ADID=DGJTQNJB85&cityname=DG",
      customerId: 5993,
      doumobkey: "krcvA8NZVV5t2TDfiHtoig==",
      issuedTime: 1555933921086,
      sessId: "epEoNFWFyxwE",
      repeatIssued: 1,
      adTags: "",
      advMaterialId: 55756,
      promotionTarget: 1,
      receiveText: "免费领取",
      manualBidPrice: 0.3,
      dkey: "5cbdaae135ebd83570dda073",
      sort: 0,
      advLayout: 1,
      expected: 0.0669,
      entityAdvForm: 1,
      onclick: function() {
        styleReset();
      }
    },
    {
      id: 4349,
      isDelete: 0,
      name: "360借条-xinxiliu6首期免息-ios1-弹层红包样式",
      advType: "398,399",
      advTitle: "360借条",
      advIntro: "东莞专享4万借款免息券",
      imageUrl:
        "https://hdggcdn.bayimob.com/qwer/img/4545/4349/20181229184825_704.gif",
      urlPath:
        "https://mkt.360jie.com.cn/activity/ch/dmshcwios/xinxiliu6?utm_content=sucai1&utm_term=datu1",
      customerId: 4545,
      doumobkey: "NcEguOTbRXKes5wVQ7f/qA==",
      issuedTime: 1555933933511,
      sessId: "QcogVpDsjoBi",
      repeatIssued: 0,
      adTags: "",
      advMaterialId: 31589,
      promotionTarget: 1,
      receiveText: "立即领取",
      manualBidPrice: 0.4,
      dkey: "5cbdaaed97714b31d070eb8c",
      sort: 0,
      advLayout: 2,
      entityAdvForm: 1,
      onclick: function() {
        styleReset2();
      }
    },
    {
      id: 5390,
      isDelete: 0,
      name: "精选频道-天天拆红包-pt",
      advType: "2,90,93",
      advTitle: "拼多多购物红包",
      advIntro: "东莞专属红包",
      imageUrl:
        "https://hdggcdn.bayimob.com/qwer/img/5735/5390/20190318125628_685.gif",
      urlPath:
        "https://mobile.yangkeduo.com/duo_red_packet.html?pid=8387768_54461665&cpsSign=CR8387768_54461665_e821ba399b5038dfc71012bf7053ce21&duoduo_type=2&launch_wx=1",
      customerId: 5735,
      doumobkey: "Yn1q2cu+joXOJAUbXlj3gA==",
      issuedTime: 1555933942769,
      sessId: "lquSxYjTgnDd",
      repeatIssued: 0,
      adTags: "",
      advMaterialId: 50398,
      promotionTarget: 1,
      receiveText: "立即领取",
      dkey: "5cbdaaf6f10c57127a8f98d0",
      sort: 113,
      advLayout: 2,
      entityAdvForm: 1,
      onclick: function() {
        styleReset2();
      }
    },
    {
      id: 559,
      isDelete: 0,
      name: "淘宝客-手机淘宝拉新-1.25-填充池2",
      advType: "218,219",
      advTitle: "手机淘宝188元大礼包",
      advIntro: "手机淘宝新用户188元大礼包",
      imageUrl:
        "https://hdggcdn.bayimob.com/qwer/img/2678/559/20190125190154_864.gif",
      urlPath: "https://s.click.taobao.com/BJD9VGw",
      customerId: 2678,
      doumobkey: "OyQNAnlEoIz/xNmE01VDVQ==",
      issuedTime: 1555933953003,
      sessId: "UBlLqZIrSGWv",
      repeatIssued: 0,
      adTags: "",
      advMaterialId: 39069,
      promotionTarget: 1,
      receiveText: "立即领取",
      dkey: "5cbdab0197714b31d0710cb0",
      sort: 0,
      advLayout: 2,
      entityAdvForm: 1,
      onclick: function() {
        styleReset2();
      }
    },
    {
      id: 5400,
      isDelete: 0,
      name: "精选频道-9.9包邮-pt",
      advType: "2,90,93",
      advTitle: "拼多多购物红包",
      advIntro: "东莞专属红包",
      imageUrl:
        "https://hdggcdn.bayimob.com/qwer/img/5735/5400/20190315135751_187.gif",
      urlPath:
        "https://mobile.yangkeduo.com/duo_nine_nine.html?pid=8387768_54471966&cpsSign=CM8387768_54471966_881f82b2845516a5b63fced5c2b1c388&duoduo_type=2&launch_wx=1",
      customerId: 5735,
      doumobkey: "GODJmny8MEdELP++/JiaYA==",
      issuedTime: 1555933961690,
      sessId: "MFnVwxmoZREc",
      repeatIssued: 0,
      adTags: "",
      advMaterialId: 49913,
      promotionTarget: 1,
      receiveText: "立即领取",
      dkey: "5cbdab09e8e244058e424713",
      sort: 0,
      advLayout: 2,
      entityAdvForm: 1,
      onclick: function() {
        styleReset2();
      }
    },
    {
      id: 5274,
      isDelete: 0,
      name: "因特利-信用卡-0075-填充",
      advType: "206,211",
      advTitle: "招商银行信用卡",
      advIntro: "东莞专享，最高5万额度金卡",
      imageUrl:
        "https://hdggcdn.bayimob.com/base_img_path_hdggadv/2678/1550644946065_红包1.gif",
      urlPath:
        "http://zx.yidejr.net/bank/dist/zhaoshang_newDM.html?webAddress=N3700MM2092O690700Y3&ctype=short&source=G50_6907",
      customerId: 2678,
      doumobkey: "mrFtl9luZsSnRFhfj+wXwQ==",
      issuedTime: 1555933972550,
      sessId: "ZygMPvGOlsiN",
      repeatIssued: 0,
      adTags: "",
      advMaterialId: 43047,
      promotionTarget: 1,
      receiveText: "立即办理",
      dkey: "5cbdab14f10c57127a8fcbde",
      sort: 0,
      advLayout: 1,
      entityAdvForm: 1,
      onclick: function() {
        styleReset();
      }
    },
    {
      id: 5400,
      isDelete: 0,
      name: "精选频道-9.9包邮-pt",
      advType: "2,90,93",
      advTitle: "拼多多购物红包",
      advIntro: "东莞专属红包",
      imageUrl:
        "https://hdggcdn.bayimob.com/qwer/img/5735/5400/20190315135751_187.gif",
      urlPath:
        "https://mobile.yangkeduo.com/duo_nine_nine.html?pid=8387768_54471966&cpsSign=CM8387768_54471966_881f82b2845516a5b63fced5c2b1c388&duoduo_type=2&launch_wx=1",
      customerId: 5735,
      doumobkey: "GODJmny8MEdELP++/JiaYA==",
      issuedTime: 1555933982669,
      sessId: "rRJETcpzaegN",
      repeatIssued: 1,
      adTags: "",
      advMaterialId: 49913,
      promotionTarget: 1,
      receiveText: "立即领取",
      dkey: "5cbdab1ee8e244058e426afe",
      sort: 0,
      advLayout: 2,
      entityAdvForm: 1,
      onclick: function() {
        styleReset2();
      }
    },
    {
      id: 559,
      isDelete: 0,
      name: "淘宝客-手机淘宝拉新-1.25-填充池2",
      advType: "218,219",
      advTitle: "手机淘宝188元大礼包",
      advIntro: "手机淘宝新用户188元大礼包",
      imageUrl:
        "https://hdggcdn.bayimob.com/qwer/img/2678/559/20190125190154_864.gif",
      urlPath: "https://s.click.taobao.com/BJD9VGw",
      customerId: 2678,
      doumobkey: "OyQNAnlEoIz/xNmE01VDVQ==",
      issuedTime: 1555933994524,
      sessId: "GynDYFPRpVfA",
      repeatIssued: 1,
      adTags: "",
      advMaterialId: 39069,
      promotionTarget: 1,
      receiveText: "立即领取",
      dkey: "5cbdab2a97714b31d071535a",
      sort: 0,
      advLayout: 2,
      entityAdvForm: 1,
      onclick: function() {
        styleReset2();
      }
    }
  ];
  let local = {
    save: function(key, value) {
      localStorage.setItem(key, JSON.stringify(value));
    },
    fetch: function(key) {
      return JSON.parse(localStorage.getItem(key));
    }
  };
  var prizeArr = null;
  var count = 8;
  prizeList();
  FZ(20, 375);
  $('.butterflies').animate({'left': '0', 'top': '5.75rem'}, 2000);
  $('.hua').animate({'right': '0', 'top': '5.5rem'}, 2500);
  var turnplate = {
    // restaraunts: [],				//大转盘奖品名称
    colors: [],					//大转盘奖品区块对应背景颜色
    outsideRadius: 198,			//大转盘外圆的半径
    textRadius: 155,				//大转盘奖品位置距离圆心的距离
    insideRadius: 34,			//大转盘内圆的半径
    startAngle: 0,				//开始角度

    bRotate: false				//false:停止;ture:旋转
  };
  
   
  $(document).ready(function () {
    $('.rule').on('click', function () {
      $('.alerty').show();
      $('.zhenotice').show();
    })
    $('body .moresay').on('click', function () {
      $(this).toggleClass('activeadv')
      $('.moresayp').toggle();
      if ($(this).hasClass("activeadv")) {
        $(".contant").scrollTop(1000);
      }
    })
    $('.alerty').on('click', '.saclose', function () {
      $('.moresay').removeClass('activeadv');
      $('.moresayp').hide();
      $('.alerty').hide();
      $('.zhenotice').hide();
    })

    //旋转转盘
    var rotateFn = function () {
      // var randomDeg = parseInt(Math.random() * 2);
      // console.log(randomDeg);
      // var angles = [620, 440][randomDeg];
      $('.bian').removeClass('active');
      $('.bian').removeAttr("style");
      $('.bian').rotate({
        angle: 0,
        animateTo: (433 + 1600),
        duration: 5000,
        callback: function () {
          var index = Math.floor(Math.random() * dataArr.length);
          var currentData = dataArr[index];
          if (currentData.advLayout === 1) {
            alertCommon(currentData.imageUrl, currentData.advIntro);
          } else {
            alertCommon2(currentData.imageUrl);
          }
          closeBtn(currentData);
          turnplate.bRotate = !turnplate.bRotate;
          $('.pointer').removeClass('stop');
          $('.pointer').attr('src', '../common/image/start2.png');
          $('.DB_guide').show();
          setTimeout(function () {
            $('.bian').addClass('active');
          }, 1000)
        }
      });

    };

    $('.pointer').click(function () {
      $(this).attr('src', '../common/image/started.png');
      $('.DB_guide').hide();
      if ($(this).hasClass('stop')) {
        return;
      }
      var count = $("#countZa").text(); //总次数
      if (count == 0) {
        $("#hdgg_show-tomorrow").show();
        return;
      }
      count--;
      $("#countZa").text(count);

      if (turnplate.bRotate) return;
      turnplate.bRotate = !turnplate.bRotate;
      rotateFn();
    });
  });
  function redpack() {
    var hdgg_redpack = $(
      '<div id="hdgg_redpack">' +
        '<div class="m-wrapper">' +
        '<div class="m-sd-bg" style="display:none;"></div>' +
        '<div class="m-top-bg"></div>' +
        '<div class="m-bottom-bg"></div>' +
        '<div class="m-btn-join"></div>' +
        '<div class="m-btn-click" style="display: none;"></div>' +
        '<div class="m-winred">' +
        "</div>" +
        "</div>" +
        "</div>"
    );
    var close = $('<div class="m-close" style=""></div>').on(
      "click",
      function() {
        hdgg_redpack.hide();
      }
    );
    $("body").append(hdgg_redpack);
    $(".m-btn-join").on("click", function() {
      $("#hdgg_redpack").hide();
      var index = Math.floor(Math.random() * dataArr.length);
      var currentData = dataArr[index];
      if (currentData.advLayout === 1) {
        alertCommon(currentData.imageUrl, currentData.advIntro);
      } else {
        alertCommon2(currentData.imageUrl);
      }
      closeBtn(currentData);
    });
    setTimeout(function() {
      hdgg_redpack.append(close);
    }, 1000);
  }
  function FZ(a, b) {
    function getFZ() {
      var width = document.documentElement.clientWidth || document.body.clientWidth;
      if (width > 750) {
        width = 750;
      }
      var fontSize = (a / b) * width;
      return fontSize;
    };
    document.documentElement.style.fontSize = getFZ() + "px";
    window.onresize = function () {
      setTimeout(function () {
        document.documentElement.style.fontSize = getFZ() + "px";
      }, 100);
    };
  };

  function getUrlParam(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return decodeURIComponent(r[2]);
    return null;
  };
//广告类型2的样式
function alertCommon2(imageUrl) {
  var strs =
    '<div id="hdgg_show-win-custom-pdd"><img id="hdgg-image-custom-pdd" class="m-image" src="' +
    imageUrl +
    '"><div class="card-sunshine"></div><span class="close-btn closetc iconfont"></span></div>';
  $("body").append(strs);
}
//显示中奖栏
$(".jiang").on("click", function() {
  $("#hdgg-record-page").addClass("hdgg-record-show");
});
//中奖拦返回
$(document).on("click", ".hd_ad_back", function() {
  $("#hdgg-record-page").removeClass("hdgg-record-show");
});
  function alertCommon(imageUrl, advIntro) {
  	var strs = '<div class="popShowPrize" id="dialog5" style="display: block; transform-origin: 0px 0px 0px; opacity: 1; transform: scale(1, 1);"><div class="caiguang"></div><div class="m-box"></div><div class="showPrize-dialog modal-body"><div class="dings"><div class="card-bg""><img src="' + imageUrl + '"></div><div class="red-bg"></div><div class="red-bg1"></div><div class="red-bg2"></div><div class="red-txt"></div><div class="detail"><div class="topic">' + advIntro + '</div><div class="goto"></div></div><span class="ribbon"></span><span class="ribbon"></span><span class="ribbon"></span><span class="ribbon"></span><span class="ribbon"></span><span class="ribbon"></span><span class="ribbon"></span><span class="ribbon"></span><span class="ribbon"></span><span class="ribbon"></span><span class="ribbon"></span><span class="ribbon"></span></div></div></div>'
  	$('body').append(strs);
  	setTimeout(function () {
  		$('#dialog5').append('<span id="close" class="close-btn closetc iconfont"></span>');
  	}, 1500)
  }
  function boxHandle(){
    setTimeout(() => {
      if(!!$(".hdgg_toMiddle").length){
        $("#hdgg_more_game_award").find("img").attr("src","../common/image/dca5403fc92f41e997399999aeace29d.gif");
        return;
      }
      $(".hdgg_toMiddle").remove();
      var award = $(
        '<div id="hdgg_more_game_award" class="hdgg_toMiddle hdgg_toMiddleForward">' +
          '<a id="hdgg_more_game_element" href="javascript:;">' +
          '<img style="display: block;width:100%;" src="../common/image/9082842bef4a42ecb6d879b93082ff13.gif">' +
          "</a>" +
          "</div>"
      );
      $("body").append(award);
    }, 800);
    setTimeout(() => {
      $("#hdgg_more_game_award").addClass("hdgg_shake");
    }, 2000);
    setTimeout(() => {
      $("#hdgg_more_game_award").addClass("hdgg_move");
    }, 3200);
}

function closeHandle() {
  var oLink = $(
    '<a href="javascript:;" style="position: fixed; top: 42%; right: 50%; z-index: 99; width: 3.4rem; height: 1.85rem; margin-right: -1.7rem;">' +
      '<img src="../common/image/fly.png" style="width: 100%;"></a>'
  );
  $("body").append(oLink);
  oLink.animate(
    { top: "1.25rem", right: "1.5rem", width: 0, marginRight: 0 },
    1000,
    function() {
      oLink.remove();
      setTimeout(function() {
        $(".jiang")
          .addClass("jiangw")
          .html(
            '<img src="../common/image/star.png" class="star addw" style="width:40%;margin-top:0.75rem;">' +
              '<img src="../common/image/star.png" class="star1 addw" style="width:35%;">' +
              '<img src="../common/image/star.png" class="star2 addw" style="width:30%;margin-top:-0.25rem;">'
          );
      }, 100);
      setTimeout(function() {
        $(".jiang")
          .removeClass("jiangw")
          .html();
      }, 1300);
    }
  );
}
  function closeBtn(res) {
    $(document).one("click", ".close-btn", function() {
      prizeArr.push({
        advIntro: res.advIntro,
        imageUrl: res.imageUrl,
        advTitle: res.advTitle,
        date: formDate(new Date())
      });
      local.save("prize", prizeArr);
      prizeList();
      if(res.advLayout===1){
        styleReset();
        closeHandle()
      }else{
        styleReset2();
        closeHandle();
        boxHandle();
      }
    });
  }
  window.styleReset = function () {
    $('#dialog5').addClass('hidem');
    $('#dialog5').remove();
    $('.DB_guide').show();
  }
  window.styleReset2 = function() {
    $("#hdgg_show-win-custom-pdd").hide();
    $("#hdgg_show-win-custom-pdd").remove();
  };
  $(document).on("click", ".m-close", function() {
    $("#hdgg_show-tomorrow").hide();
  });
  
  const formDate = timestamp => {
    const date = new Date(timestamp);
    const Y = date.getFullYear() + "-";
    const M =
      (date.getMonth() + 1 < 10
        ? "0" + (date.getMonth() + 1)
        : date.getMonth() + 1) + "-";
    const D =
      date.getDate() < 10 ? "0" + date.getDate() + " " : date.getDate() + " ";
    const h =
      date.getHours() < 10 ? "0" + date.getHours() + ":" : date.getHours() + ":";
    const m =
      date.getMinutes() < 10
        ? "0" + date.getMinutes() + ":"
        : date.getMinutes() + ":";
    const s =
      date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
    return Y + M + D + h + m + s;
  };
  function prizeList() {
    $(".m-transition-dom").remove();
    prizeArr = !local.fetch("prize") ? [] : local.fetch("prize");
    if(!prizeArr.length){
      redpack();
    }
    console.log(count,'count')
    $("#countZa").text(count - prizeArr.length);
    var strs = "";
    for (var i = 0; i < prizeArr.length; i++) {
      strs +=
        '<a href="javascript:;">' +
        '<div class="hd_time">' +
        prizeArr[i].date +
        "</div>" +
        '<img src="' +
        prizeArr[i].imageUrl +
        '">' +
        '<p class="hd_ad_title">' +
        prizeArr[i].advTitle +
        "</p>" +
        "<p>" +
        prizeArr[i].advIntro +
        "</p>" +
        '<div class="hd_ad_tip">已中奖</div>' +
        '<div class="hd_ad_lingjiang">查看</div>';
      ("</a>");
    }
    var str =
      '<div id="hdgg-record-page" style="display: block;" class="m-transition-dom">' +
      '<div class="hd_ad_hd">' +
      '<div class="hd_ad_back">返回</div>' +
      "<p>我的奖品</p>" +
      "</div>" +
      '<div id="someMedia" style="overflow:auto">' +
      '<div class="hd_ad_list">' +
      (!!prizeArr.length
        ? strs
        : '<div class="hd_ad_noprize">您还没有获得奖品,快去玩游戏吧～</div>') +
      "</div>" +
      "</div>" +
      "</div>";
    $("body").append(str);
  }
  
})

